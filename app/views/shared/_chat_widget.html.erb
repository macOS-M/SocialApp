<div id="chat-widget" 
     class="fixed bottom-0 right-6 w-96 bg-white shadow-2xl rounded-t-xl border border-gray-300 transition-all duration-300 ease-in-out z-50 hidden"
     style="position: fixed !important; bottom: 0 !important; right: 1.5rem !important; z-index: 9999 !important; max-height: 600px !important;"
     data-controller="chat-widget"
     data-chat-widget-current-user-id-value="<%= current_user.id %>">
  
  <!-- Header -->
  <div class="bg-gradient-to-r from-gray-900 to-black text-white p-4 rounded-t-xl flex justify-between items-center"
       style="cursor: pointer; background: linear-gradient(90deg, #0b0b0b 0%, #000000 100%) !important;">
    <div class="flex items-center space-x-3">
  <div class="w-10 h-10 rounded-full bg-gray-800/60 flex items-center justify-center overflow-hidden border border-gray-700 mr-3">
        <img id="chat-recipient-avatar-img" src="" alt="avatar" class="w-full h-full object-cover rounded-full hidden" />
        <span id="chat-recipient-avatar" class="text-white font-bold text-sm"></span>
      </div>
      <div>
        <h3 id="chat-recipient-name" class="font-semibold text-lg">Select a friend</h3>
      </div>
    </div>
    <div class="flex items-center space-x-2">
      <button type="button" 
              class="hover:bg-white/20 rounded-full p-1 transition"
              data-action="click->chat-widget#toggleMinimize"
              style="background: transparent; border: none; cursor: pointer;">
        <svg id="minimize-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>
      <button type="button" 
              class="hover:bg-white/20 rounded-full p-1 transition"
              data-action="click->chat-widget#closeChat"
              style="background: transparent; border: none; cursor: pointer;">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Body -->
  <div id="chat-body" class="transition-all duration-300 ease-in-out overflow-hidden" style="height: auto;">
    <div id="chat-messages" 
         class="h-96 overflow-y-auto p-4 space-y-3 bg-gray-50"
         style="height: 400px; overflow-y: auto;"
         data-chat-widget-target="messagesContainer">
      <p class="text-center text-gray-500 text-sm">Loading messages...</p>
    </div>

    <!-- Input -->
    <div class="p-4 bg-white border-t border-gray-200">
      <form id="chat-message-form" 
            data-action="submit->chat-widget#sendMessage"
            data-chat-widget-target="messageForm">
        <input type="hidden" id="chat-recipient-id" name="recipient_id" data-chat-widget-target="recipientId">
        <div class="flex space-x-2">
          <input type="text" 
                 id="chat-message-input"
                 name="body"
                 placeholder="Type a message..."
                 class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                 data-chat-widget-target="messageInput"
                 autocomplete="off">
          <button type="submit" 
                  class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
                  data-chat-widget-target="sendButton">
            Send
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
